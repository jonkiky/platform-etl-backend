spark-uri = null
common {
  default-steps = [
    "disease",
    "target",
    "reactome",
    "eco",
    "drug"
    "interactions",
    "drugBeta",
    "networks",
    "cancerBiomarkers",
    "search",
    "evidenceDrugDirect",
    "ddr",
    "expression",
    "mousePhenotypes",
    "evidence",
    "association",
    "associationOTF"
    // "dailymed",
    // "clinicalTrials",
  ]
  output-format = "json"
  output = "gs://ot-snapshots/etl/latest"
  output = ${?OT_ETL_OUTPUT}
  inputs {
    ddr  {
      format ="parquet"
      path = "gs://ot-snapshots/parquet/20.06/parquet/relation_parquet"
    }
    disease  {
      format ="parquet"
      path = "gs://ot-snapshots/parquet/20.06/parquet/efo_parquet"
    }
    drug  {
     format ="parquet"
     path = "gs://ot-snapshots/parquet/20.06/parquet/drug_parquet"
    }
     evidence  {
      format ="parquet"
      path = "gs://ot-snapshots/parquet/20.06/parquet/evidence_parquet"
    }
    eco  {
      format ="parquet"
      path = "gs://ot-snapshots/parquet/20.06/parquet/eco_parquet"
    }
    expression  {
      format ="parquet"
      path = "gs://ot-snapshots/parquet/20.06/parquet/expression_parquet/"
    }
    mousephenotypes {
      format ="json"
      path = "gs://ot-snapshots/jsonl/20.06/parquet/20.06/parquet_mousephenotypes.json"
    }
    reactome {
      format ="parquet"
      path = "gs://ot-snapshots/parquet/20.06/parquet/rea_parquet"
    }
    target {
      format ="parquet"
      path = "gs://ot-snapshots/parquet/20.06/parquet/gene_parquet"
    }
    tep {
      format ="json"
      path = "gs://ot-snapshots/jsonl/20.06/tep-2020-06-01.json"
    }
    drug-beta {
      chembl-molecule {
        format = "json"
        path = "gs://ot-snapshots/jsonl/chembl/chembl_27_molecule-2020-10-08.jsonl"
      }
      chembl-indication {
        format = "json"
        path = "gs://ot-snapshots/jsonl/chembl/chembl_27_drug_indication-2020-10-08.jsonl"
      }
      chembl-mechanism {
        format = "json"
        path = "gs://ot-snapshots/jsonl/chembl/chembl_27_mechanism-2020-10-08.jsonl"
      }
      chembl-target {
        format = "json"
        path = "gs://ot-snapshots/jsonl/chembl/chembl_27_target-2020-10-08.jsonl"
      }
      disease-pipeline: ${?common.inputs.disease}
      target-pipeline: ${?common.inputs.target}
      evidence-pipeline: ${?common.inputs.evidence}
      drugbank-to-chembl {
        format = "tsv"
        path = "gs://ot-team/jarrod/drugbank/db.csv.gz"
      }
      drug-extensions = [
        {
          extension-type = "synonym"
          path = "gs://ot-team/jarrod/drugbank/db.json"
        }
      ]
    }
    interactions {
       rnacentral {
          format = "json"
          path = "gs://ot-snapshots/parquet/20.09/json/"
       }
       humanmapping {
          format = "json"
          path = "gs://ot-snapshots/parquet/20.09/json/"
       }
       ensproteins {
          format = "json"
          path = "gs://ot-snapshots/parquet/20.09/json/"
       }
       intact {
          format = "json"
          path = "gs://ot-snapshots/parquet/20.09/json/interactor_pair_interactions.json"
       }
       strings = {
          format = "json"
          path = "gs://ot-snapshots/parquet/20.09/json/strings.json"
       }
    }
  }
}
// donwloaded from here https://aact.ctti-clinicaltrials.org/pipe_files
clinical-trials {
  studies = "clinicaltrials/studies.txt"
  study-references = "clinicaltrials/study_references.txt"
  countries = "clinicaltrials/countries.txt"
  sponsors = "clinicaltrials/sponsors.txt"
  interventions = "clinicaltrials/interventions.txt"
  interventions-other-names = "clinicaltrials/intervention_other_names.txt"
  interventions-mesh = "clinicaltrials/browse_interventions.txt"
  conditions = "clinicaltrials/conditions.txt"
  conditions-mesh = "clinicaltrials/browse_conditions.txt"
}

// downloaded from here https://dailymed.nlm.nih.gov/dailymed/spl-resources-all-mapping-files.cfm
// and here https://dailymed.nlm.nih.gov/dailymed/spl-resources-all-drug-labels.cfm
dailymed {
  rxnorm-mapping = "dailymed/mappings/rxnorm_mappings.txt"
  //    prescriptionData = "dailymed/data/part2/prescription/7c727af7-b69e-4079-92a8-91a4f059e0bf.xml"
  //    prescriptionData = "dailymed/data/part1/prescription/51c9bd8b-d604-54a0-e054-00144ff8d46c.xml"
  prescription-data = "dailymed/data/**/prescription/*.xml"
}

// this is a temporal fix that have to be removed eventually
evidence-protein-fix {
  // input = "evidences/*.json.gz"
  input = "evidences/chembl-2019-08-16.json.gz"
  output = ${common.output}"/evidences_protein_fix"
}

evidences {
  input {
    format = "parquet"
    path = "/home/mkarmona/src/opentargets/data/platform/20.11/evidences-raw-parquet/"
  }

  unique-fields = [
    "targetId",
    "targetFromSourceId",
    "diseaseId",
    "diseaseFromSourceId",
    "datasourceId"
  ]

  score-expr = "resourceScore"

  data-sources = [
    {
      id: "chembl",
      unique-fields: [
        "drugId",
        "clinicalUrls.url"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "europepmc",
      unique-fields: [
        "literature"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "eva",
      unique-fields: [
        "recordId",
        "variantId"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "eva_somatic",
      unique-fields: [
        "recordId",
        "variantId"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "expression_atlas",
      unique-fields: [
        "contrast",
        "studyId"
      ],
      score-expr: "array_min(array(1.0, (1.0 - resourceScore) * (abs(log2FoldChangeValue) / 10) * (log2FoldChangePercentileRank / 100)))"
    },
    {
      id: "gene2phenotype",
      unique-fields: [
        "diseaseFromSource"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "genomics_england",
      unique-fields: [
        "diseaseFromSource",
        "studyId"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "intogen",
      unique-fields: [
        "cohortShortName"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "ot_genetics_portal",
      unique-fields: [
        "studyId",
        "variantId"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "phenodigm",
      unique-fields: [
        "diseaseFromSource",
        "biologicalModelAllelicComposition",
        "targetInModel",
        "biologicalModelGeneticBackground"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "phewas_catalog",
      unique-fields: [
        "diseaseFromSource",
        "variantId"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "progeny",
      unique-fields: [
        "pathwayId",
        "diseaseFromSource"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "reactome",
      unique-fields: [
        "variants.aminoacidDescription",
        "targetModulation",
        "reactionId"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "slapenrich",
      unique-fields: [
        "pathwayId",
        "diseaseFromSource"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "sysbio",
      unique-fields: [
        "studyOverview",
        "literature"
      ],
      score-expr: "resourceScore"
    },
    {
      id: "uniprot_literature"
      unique-fields: [
        "diseaseFromSource",
      ],
      score-expr: "resourceScore"
    },
    {
      id: "clingen"
      unique-fields: [
        "recordId"
      ],
      score-expr: "resourceScore"
    }
  ]
}

# {
//"data": {
//  "associationDatasources": [
//    {
//      "datasource": "uniprot_somatic",
//      "datatype": "somatic_mutation"
//    },
//    {
//      "datasource": "genomics_england",
//      "datatype": "genetic_association"
//    },
//    {
//      "datasource": "sysbio",
//      "datatype": "affected_pathway"
//    },
//    {
//      "datasource": "phewas_catalog",
//      "datatype": "genetic_association"
//    },
//    {
//      "datasource": "phenodigm",
//      "datatype": "animal_model"
//    },
//    {
//      "datasource": "eva_somatic",
//      "datatype": "somatic_mutation"
//    },
//    {
//      "datasource": "gene2phenotype",
//      "datatype": "genetic_association"
//    },
//    {
//      "datasource": "expression_atlas",
//      "datatype": "rna_expression"
//    },
//    {
//      "datasource": "eva",
//      "datatype": "genetic_association"
//    },
//    {
//      "datasource": "ot_genetics_portal",
//      "datatype": "genetic_association"
//    },
//    {
//      "datasource": "europepmc",
//      "datatype": "literature"
//    },
//    {
//      "datasource": "progeny",
//      "datatype": "affected_pathway"
//    },
//    {
//      "datasource": "slapenrich",
//      "datatype": "affected_pathway"
//    },
//    {
//      "datasource": "crispr",
//      "datatype": "affected_pathway"
//    },
//    {
//      "datasource": "uniprot_literature",
//      "datatype": "genetic_association"
//    },
//    {
//      "datasource": "cancer_gene_census",
//      "datatype": "somatic_mutation"
//    },
//    {
//      "datasource": "chembl",
//      "datatype": "known_drug"
//    },
//    {
//      "datasource": "reactome",
//      "datatype": "affected_pathway"
//    },
//    {
//      "datasource": "intogen",
//      "datatype": "somatic_mutation"
//    },
//    {
//      "datasource": "clingen",
//      "datatype": "genetic_association"
//    }
//  ]
//}
//}

associations {
  default-weight = 1.0
  default-propagate = true
  data-sources = [
    {id: "cancer_gene_census", weight = 1, data-type = "somatic_mutation", propagate = true},
    {id: "chembl", weight = 1, data-type = "known_drug", propagate = true},
    {id: "crispr", weight: 1, data-type = "affected_pathway", propagate = true},
    {id: "europepmc", weight: 0.2, data-type = "literature", propagate = true},
    {id: "eva", weight: 1, data-type = "genetic_association", propagate = true},
    {id: "eva_somatic", weight: 1, data-type = "somatic_mutation", propagate = true},
    {id: "expression_atlas", weight: 0.2, data-type = "rna_expression", propagate = false},
    {id: "gene2phenotype", weight: 1, data-type = "genetic_association", propagate = true},
    {id: "genomics_england", weight: 1, data-type = "genetic_association", propagate = true},
    {id: "ot_genetics_portal", weight: 1, data-type = "genetic_association", propagate = true},
    {id: "intogen", weight: 1, data-type = "somatic_mutation", propagate = true},
    {id: "phenodigm", weight: 0.2, data-type = "animal_model", propagate = true},
    {id: "phewas_catalog", weight: 1, data-type = "genetic_association", propagate = true},
    {id: "progeny", weight: 0.5, data-type = "affected_pathway", propagate = true},
    {id: "reactome", weight: 1, data-type = "affected_pathway", propagate = true},
    {id: "slapenrich", weight: 0.5, data-type = "affected_pathway", propagate = true},
    {id: "sysbio", weight: 0.5, data-type = "affected_pathway", propagate = true},
    {id: "uniprot", weight: 1, data-type = "genetic_association", propagate = true},
    {id: "uniprot_literature", weight: 1, data-type = "genetic_association", propagate = true},
    {id: "uniprot_somatic", weight: 1, data-type = "somatic_mutation", propagate = true}
  ]
}
